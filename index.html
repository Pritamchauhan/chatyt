<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotAi-Pritam | Real AI Video Notes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --cyan: #00f2ff; --purple: #bc13fe; }
        body { background: #050505; color: #eee; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; }
        .neon-text { background: linear-gradient(90deg, var(--cyan), var(--purple)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .notes-content h1 { color: var(--cyan); font-size: 22px; font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px; }
        .notes-content h2 { color: var(--purple); font-size: 18px; margin-top: 20px; font-weight: 600; }
        .notes-content p, .notes-content li { color: #ccc; line-height: 1.6; margin-bottom: 10px; }
        .example-card { border-left: 4px solid var(--cyan); background: rgba(0, 242, 255, 0.05); padding: 15px; margin: 15px 0; border-radius: 0 10px 10px 0; }
        .loader { border-top-color: var(--cyan); animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="p-4 md:p-10">

    <div class="max-w-6xl mx-auto">
        <div class="flex justify-between items-center mb-8">
            <h1 class="text-4xl font-black neon-text">NotAi-Pritam</h1>
            <button onclick="toggleApiBox()" class="text-xs text-gray-400 border border-gray-700 px-4 py-2 rounded-full hover:bg-white hover:text-black transition">‚öôÔ∏è Setup API Key</button>
        </div>

        <div id="apiBox" class="hidden glass p-6 mb-8 border-t-2 border-purple-600">
            <h3 class="text-xs font-bold text-purple-400 mb-3 uppercase tracking-widest">Google Gemini API Configuration</h3>
            <input type="password" id="apiKey" placeholder="Paste your Gemini API Key here..." class="w-full bg-black border border-gray-800 p-3 rounded-lg text-sm focus:border-cyan-400 outline-none">
            <p class="text-[10px] text-gray-500 mt-2">Get a free key from <a href="https://aistudio.google.com/" target="_blank" class="underline text-cyan-500">Google AI Studio</a></p>
        </div>

        <div class="glass p-6 mb-10">
            <div class="flex flex-col md:flex-row gap-4">
                <select id="lang" class="bg-black text-white px-4 py-3 rounded-xl border border-gray-800 outline-none">
                    <option value="Hinglish">Hinglish</option>
                    <option value="Hindi">Hindi</option>
                    <option value="English">English</option>
                </select>
                <input type="text" id="videoUrl" placeholder="Paste YouTube Video Link..." class="flex-1 bg-black/40 border border-gray-800 p-4 rounded-xl focus:border-purple-500 outline-none">
                <button onclick="processVideo()" class="bg-gradient-to-r from-[#00f2ff] to-[#bc13fe] text-black font-bold px-8 py-4 rounded-xl hover:scale-105 transition">GENERATE</button>
            </div>
        </div>

        <div id="resultArea" class="hidden grid grid-cols-1 lg:grid-cols-5 gap-8">
            <div class="lg:col-span-2 space-y-6">
                <div id="player" class="glass aspect-video overflow-hidden"></div>
                
                <div class="glass p-6">
                    <h4 class="text-cyan-400 font-bold mb-3">Ask NotAi-Pritam</h4>
                    <div id="chatBox" class="h-40 overflow-y-auto text-xs space-y-2 mb-4 p-2 bg-black/20 rounded">
                        <div class="text-gray-500 italic">Chat history will appear here...</div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chatInput" class="flex-1 bg-black/50 border border-gray-800 rounded-lg p-3 text-sm outline-none" placeholder="Ask a question...">
                        <button onclick="askAI()" class="bg-purple-600 px-4 rounded-lg">üöÄ</button>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-3">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-sm text-gray-400 font-mono">Status: <span id="statusText" class="text-green-500">Ready</span></span>
                    <div class="flex gap-2">
                        <button onclick="downloadPDF()" class="bg-red-500/20 text-red-400 border border-red-500/50 px-3 py-1 rounded text-xs hover:bg-red-500 hover:text-white">PDF</button>
                        <button onclick="downloadJPG()" class="bg-blue-500/20 text-blue-400 border border-blue-500/50 px-3 py-1 rounded text-xs hover:bg-blue-500 hover:text-white">JPG</button>
                    </div>
                </div>
                
                <div id="notesCanvas" class="glass p-8 min-h-[500px] notes-content">
                    <div id="loader" class="hidden flex flex-col items-center justify-center py-20">
                        <div class="loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-12 w-12 mb-4"></div>
                        <p class="text-cyan-400 animate-pulse">Pritam AI is analyzing the video...</p>
                    </div>
                    <div id="notesContainer"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentNotesContext = "";

        function toggleApiBox() { document.getElementById('apiBox').classList.toggle('hidden'); }

        function extractVideoID(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        async function processVideo() {
            const url = document.getElementById('videoUrl').value;
            const key = document.getElementById('apiKey').value;
            const lang = document.getElementById('lang').value;
            const vid = extractVideoID(url);

            if(!vid) return alert("Bhai, YouTube URL sahi nahi hai!");
            if(!key) return alert("Pehle Setup API mein jaake Gemini Key daalo!");

            document.getElementById('resultArea').classList.remove('hidden');
            document.getElementById('player').innerHTML = `<iframe width="100%" height="100%" src="https://www.youtube.com/embed/${vid}" frameborder="0" allowfullscreen></iframe>`;
            document.getElementById('loader').classList.remove('hidden');
            document.getElementById('notesContainer').innerHTML = "";

            try {
                const prompt = `Act as an expert educator. Based on the YouTube video (ID: ${vid}), generate extremely detailed study notes in ${lang} language. 
                Structure it with: 
                - A main Heading (h1)
                - Detailed Sub-sections (h2)
                - Bullet points for key facts
                - A specialized 'Example Box' using <div class="example-card"> tag for every main topic.
                Only return the HTML content, no extra talk.`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
                });

                const data = await response.json();
                let aiText = data.candidates[0].content.parts[0].text;
                
                // Clean AI markdown if present
                aiText = aiText.replace(/```html/g, "").replace(/```/g, "");
                
                currentNotesContext = aiText;
                document.getElementById('loader').classList.add('hidden');
                document.getElementById('notesContainer').innerHTML = aiText;
                document.getElementById('statusText').innerText = "Notes Generated!";

            } catch (err) {
                alert("Error: API request fail ho gaya. Key check karein.");
                document.getElementById('loader').classList.add('hidden');
            }
        }

        async function askAI() {
            const query = document.getElementById('chatInput').value;
            const key = document.getElementById('apiKey').value;
            if(!query || !currentNotesContext) return;

            const chatBox = document.getElementById('chatBox');
            chatBox.innerHTML += `<div class="text-cyan-400"><b>You:</b> ${query}</div>`;
            document.getElementById('chatInput').value = "";

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${key}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ 
                        contents: [{ parts: [{ text: `Context: ${currentNotesContext}\n\nQuestion: ${query}\nAnswer shortly.` }] }] 
                    })
                });
                const data = await response.json();
                const answer = data.candidates[0].content.parts[0].text;
                chatBox.innerHTML += `<div class="text-white"><b>Pritam AI:</b> ${answer}</div>`;
                chatBox.scrollTop = chatBox.scrollHeight;
            } catch (e) { alert("Chat Error!"); }
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'pt', 'a4');
            doc.html(document.getElementById('notesCanvas'), {
                callback: function(d) { d.save('NotAi-Pritam-Notes.pdf'); },
                margin: [40, 40, 40, 40], x: 0, y: 0, width: 500, windowWidth: 800
            });
        }

        function downloadJPG() {
            html2canvas(document.getElementById('notesCanvas'), {backgroundColor:'#050505', scale: 2}).then(canvas => {
                const link = document.createElement('a');
                link.download = 'NotAi-Pritam-Notes.jpg';
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
